<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Cases</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .balance {
            font-size: 1.5em;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .case-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: #ffd700;
        }

        .case-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .case-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .case-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .case-price {
            color: #ffd700;
            font-weight: bold;
        }

        .opening-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }

        .case-opening {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite, rotate 2s infinite linear;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }

        .result-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 2px solid;
            animation: fadeInScale 0.5s ease;
        }

        .result-card.legendary { border-color: #ff6b35; }
        .result-card.rare { border-color: #9b59b6; }
        .result-card.common { border-color: #3498db; }

        .result-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .result-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 2em;
            color: #ffd700;
            font-weight: bold;
        }

        .close-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .inventory {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .inventory-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .inventory-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.8em;
        }

        .sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üíé Crystal Cases</h1>
            <div class="balance">üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance">1000</span> –º–æ–Ω–µ—Ç</div>
        </div>

        <div class="cases-grid">
            <div class="case-card" data-case="bronze" data-price="100">
                <span class="case-icon">üì¶</span>
                <div class="case-name">–ë—Ä–æ–Ω–∑–æ–≤—ã–π –∫–µ–π—Å</div>
                <div class="case-price">100 –º–æ–Ω–µ—Ç</div>
                <div class="sparkles"></div>
            </div>
            <div class="case-card" data-case="silver" data-price="250">
                <span class="case-icon">üíº</span>
                <div class="case-name">–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–µ–π—Å</div>
                <div class="case-price">250 –º–æ–Ω–µ—Ç</div>
                <div class="sparkles"></div>
            </div>
            <div class="case-card" data-case="gold" data-price="500">
                <span class="case-icon">üéÅ</span>
                <div class="case-name">–ó–æ–ª–æ—Ç–æ–π –∫–µ–π—Å</div>
                <div class="case-price">500 –º–æ–Ω–µ—Ç</div>
                <div class="sparkles"></div>
            </div>
            <div class="case-card" data-case="diamond" data-price="1000">
                <span class="case-icon">üíé</span>
                <div class="case-name">–ê–ª–º–∞–∑–Ω—ã–π –∫–µ–π—Å</div>
                <div class="case-price">1000 –º–æ–Ω–µ—Ç</div>
                <div class="sparkles"></div>
            </div>
        </div>

        <div class="inventory">
            <div class="inventory-title">üìã –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <div class="inventory-items" id="inventory"></div>
        </div>
    </div>

    <div class="opening-overlay" id="openingOverlay">
        <div class="case-opening" id="caseOpening">üì¶</div>
        <div>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...</div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }

        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            balance: 1000,
            inventory: []
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–µ–π—Å–æ–≤
        const casesConfig = {
            bronze: {
                icon: 'üì¶',
                items: [
                    { name: '–ú–µ–¥–Ω–∞—è –º–æ–Ω–µ—Ç–∞', icon: 'ü™ô', rarity: 'common', value: 50 },
                    { name: '–ë—Ä–æ–Ω–∑–æ–≤—ã–π —â–∏—Ç', icon: 'üõ°Ô∏è', rarity: 'common', value: 75 },
                    { name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', icon: '‚öîÔ∏è', rarity: 'rare', value: 150 }
                ]
            },
            silver: {
                icon: 'üíº',
                items: [
                    { name: '–°–µ—Ä–µ–±—Ä—è–Ω–∞—è –º–æ–Ω–µ—Ç–∞', icon: 'ü•à', rarity: 'common', value: 100 },
                    { name: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫—Ä–∏—Å—Ç–∞–ª–ª', icon: 'üíú', rarity: 'rare', value: 300 },
                    { name: '–†–µ–¥–∫–∏–π —Å–∞–º–æ—Ü–≤–µ—Ç', icon: 'üíé', rarity: 'legendary', value: 600 }
                ]
            },
            gold: {
                icon: 'üéÅ',
                items: [
                    { name: '–ó–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞', icon: 'ü•á', rarity: 'rare', value: 200 },
                    { name: '–í–æ–ª—à–µ–±–Ω—ã–π –∂–µ–∑–ª', icon: 'ü™Ñ', rarity: 'rare', value: 400 },
                    { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ', icon: 'üó°Ô∏è', rarity: 'legendary', value: 800 }
                ]
            },
            diamond: {
                icon: 'üíé',
                items: [
                    { name: '–ê–ª–º–∞–∑–Ω–∞—è –∫–æ—Ä–æ–Ω–∞', icon: 'üëë', rarity: 'legendary', value: 500 },
                    { name: '–ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç', icon: 'üîÆ', rarity: 'legendary', value: 1200 },
                    { name: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—á', icon: '‚ö°', rarity: 'legendary', value: 2000 }
                ]
            }
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('balance').textContent = gameData.balance;
            updateInventory();
            updateCaseAvailability();
        }

        function updateInventory() {
            const inventory = document.getElementById('inventory');
            if (gameData.inventory.length === 0) {
                inventory.innerHTML = '<div style="text-align: center; opacity: 0.7;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                return;
            }

            inventory.innerHTML = gameData.inventory.map(item => 
                `<div class="inventory-item">
                    <div>${item.icon}</div>
                    <div>${item.name}</div>
                    <div style="color: #ffd700;">${item.value}</div>
                </div>`
            ).join('');
        }

        function updateCaseAvailability() {
            document.querySelectorAll('.case-card').forEach(card => {
                const price = parseInt(card.dataset.price);
                if (gameData.balance < price) {
                    card.classList.add('disabled');
                } else {
                    card.classList.remove('disabled');
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–∫–æ—Ä–æ–∫
        function createSparkles(element) {
            const sparklesContainer = element.querySelector('.sparkles');
            sparklesContainer.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                sparklesContainer.appendChild(sparkle);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–∫–æ—Ä–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∫–µ–π—Å–æ–≤
        document.querySelectorAll('.case-card').forEach(createSparkles);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–æ–≤
        document.querySelectorAll('.case-card').forEach(card => {
            card.addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;

                const caseType = this.dataset.case;
                const price = parseInt(this.dataset.price);
                
                if (gameData.balance >= price) {
                    openCase(caseType, price);
                }
            });
        });

        function openCase(caseType, price) {
            // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            gameData.balance -= price;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è
            const overlay = document.getElementById('openingOverlay');
            const caseIcon = document.getElementById('caseOpening');
            caseIcon.textContent = casesConfig[caseType].icon;
            overlay.style.display = 'flex';

            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            setTimeout(() => {
                const result = getRandomItem(casesConfig[caseType].items);
                gameData.inventory.push(result);
                showResult(result);
            }, 3000);
        }

        function getRandomItem(items) {
            // –í–µ—Å–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–µ–¥–∫–æ—Å—Ç–∏
            const weights = {
                common: 0.6,
                rare: 0.3,
                legendary: 0.1
            };

            const random = Math.random();
            let cumulativeWeight = 0;

            for (const item of items) {
                cumulativeWeight += weights[item.rarity];
                if (random <= cumulativeWeight) {
                    return { ...item };
                }
            }

            return items[0]; // Fallback
        }

        function showResult(item) {
            const overlay = document.getElementById('openingOverlay');
            
            overlay.innerHTML = `
                <div class="result-card ${item.rarity}">
                    <div class="result-icon">${item.icon}</div>
                    <div class="result-name">${item.name}</div>
                    <div class="result-value">${item.value} –º–æ–Ω–µ—Ç</div>
                    <button class="close-btn" onclick="closeResult()">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
                </div>
            `;

            // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            if (window.Telegram && window.Telegram.WebApp.HapticFeedback) {
                if (item.rarity === 'legendary') {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
                } else if (item.rarity === 'rare') {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                } else {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }
            }
        }

        function closeResult() {
            document.getElementById('openingOverlay').style.display = 'none';
            updateUI();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateUI();

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–¥–ª—è –¥–µ–º–æ)
        setInterval(() => {
            gameData.balance += 50;
            updateUI();
        }, 30000);
    </script>
</body>
</html>